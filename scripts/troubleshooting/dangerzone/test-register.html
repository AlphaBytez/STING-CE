<!DOCTYPE html>
<html>
<head>
    <title>Test Registration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
            display: block;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .results {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>STING Registration Test</h1>
    <p>This page provides different options to test the registration flow with Kratos.</p>

    <div>
        <h2>Direct Registration via Kratos</h2>
        <button onclick="redirectToKratos()">Direct Registration (Kratos)</button>
    </div>

    <div>
        <h2>Registration via Proxy</h2>
        <button onclick="registerViaProxy()">Registration via Proxy</button>
    </div>

    <div>
        <h2>Registration via API</h2>
        <button onclick="registerViaApi()">Get Registration Flow via API</button>
        <div id="api-results" class="results">Results will appear here...</div>
    </div>

    <script>
        function redirectToKratos() {
            // Get the current origin for the return_to URL
            const currentOrigin = window.location.origin;
            const returnUrl = currentOrigin + '/register';
            window.location.href = 'https://localhost:4433/self-service/registration/browser?return_to=' + encodeURIComponent(returnUrl);
        }

        function registerViaProxy() {
            // Get the current origin for the return_to URL
            const currentOrigin = window.location.origin;
            const returnUrl = currentOrigin + '/register';
            window.location.href = 'http://localhost:3000/self-service/registration/browser?return_to=' + encodeURIComponent(returnUrl);
        }

        async function registerViaApi() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = 'Loading...';
            
            try {
                // Start a new registration flow
                const response = await fetch('https://localhost:4433/self-service/registration/api', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Display results
                resultsDiv.innerHTML = '<h3>Registration Flow Created</h3><pre>' + 
                    JSON.stringify(data, null, 2) + '</pre>';
                
                // Store flow ID locally
                localStorage.setItem('registrationFlowId', data.id);
                
            } catch (error) {
                resultsDiv.innerHTML = '<h3>Error</h3><p>' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>